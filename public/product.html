<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | ‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤</title>
  <link rel="stylesheet" href="admin.css" />
</head>
<body class="admin-body">

  <!-- üîπ Navbar -->
  <nav class="admin-navbar">
    <h1>Admin</h1>
    <div class="admin-links">
      <a href="admin.html">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</a>
      <a href="product.html" class="active">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
      <button id="logout-btn" class="logout-btn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
  </nav>

  <!-- üîπ ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
  <main class="admin-main">
    <h2>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

    <section class="admin-form">
      <h3 id="form-title">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>

      <div class="form-grid">
        <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" />
        <input id="price" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)" />
        <input id="stock" type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å" />

        <div class="form-image">
          <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
          <input id="image" type="file" accept="image/*" />
        </div>

        <select id="status">
          <option value="‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
          <option value="‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å">‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å</option>
          <option value="‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤">‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤</option>
        </select>

        <select id="tag">
          <option value="">‡∏õ‡∏Å‡∏ï‡∏¥</option>
          <option value="hot">üî• Hot</option>
          <option value="new">üÜï New</option>
        </select>

        <select id="page" class="wide">
          <option value="both">‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡πÅ‡∏•‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
          <option value="index">‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)</option>
          <option value="all">‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤ All</option>
        </select>
      </div>

      <div class="form-buttons">
        <button id="reset-btn" class="gray">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <button id="save-btn" class="green">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
      </div>
    </section>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
    <section class="product-table">
      <h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
      <table>
        <thead>
          <tr>
            <th>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
            <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
            <th>‡∏™‡∏ï‡πá‡∏≠‡∏Å</th>
            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th>‡∏õ‡πâ‡∏≤‡∏¢</th>
            <th>‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</th>
            <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="product-list"></tbody>
      </table>
    </section>
  </main>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Popup ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö -->
  <div id="logout-popup" class="popup hidden">
    <div class="popup-box">
      <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</h3>
      <p>‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?</p>
      <div class="popup-buttons">
        <button id="confirm-logout" class="red">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        <button id="cancel-logout" class="gray">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </div>
  </div>

  <script >
    const nameInput = document.getElementById("name");
    const priceInput = document.getElementById("price");
    const stockInput = document.getElementById("stock");
    const imageInput = document.getElementById("image");
    const statusInput = document.getElementById("status");
    const tagInput = document.getElementById("tag");
    const pageInput = document.getElementById("page");
    const saveBtn = document.getElementById("save-btn");
    const resetBtn = document.getElementById("reset-btn");
    const productList = document.getElementById("product-list");
    const formTitle = document.getElementById("form-title");
    const toast = document.getElementById("toast");

    let editIndex = null;
    let uploadedImage = "";

    // ===== Toast ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô =====
    function showToast(msg) {
      toast.textContent = msg;
      toast.style.opacity = "1";
      setTimeout(() => (toast.style.opacity = "0"), 1500);
    }

    // ===== ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô localStorage =====
    function getProducts() {
      return JSON.parse(localStorage.getItem("products")) || [];
    }
    function saveProducts(p) {
      localStorage.setItem("products", JSON.stringify(p));
    }

    // ===== ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á =====
    function renderProducts() {
      const products = getProducts();
      if (products.length === 0) {
        productList.innerHTML = `<tr><td colspan="8" class="text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</td></tr>`;
        return;
      }

      productList.innerHTML = products.map((p, i) => `
        <tr>
          <td><img src="${p.image}" alt="${p.name}" style="width:60px;height:60px;object-fit:cover;border-radius:6px"></td>
          <td>${p.name}</td>
          <td>‡∏ø${p.price}</td>
          <td>${p.stock}</td>
          <td>${p.status}</td>
          <td>${p.tag || "-"}</td>
          <td>${p.page}</td>
          <td>
            <button onclick="editProduct(${i})" class="admin-btn yellow">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <button onclick="deleteProduct(${i})" class="admin-btn red">‡∏•‡∏ö</button>
          </td>
        </tr>
      `).join("");
    }

    // ===== ‡∏≠‡πà‡∏≤‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î =====
    imageInput.addEventListener("change", e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          uploadedImage = event.target.result; // base64
        };
        reader.readAsDataURL(file);
      }
    });

    // ===== ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ =====
    saveBtn.addEventListener("click", () => {
      const name = nameInput.value.trim();
      const price = parseFloat(priceInput.value);
      const stock = parseInt(stockInput.value);
      const image = uploadedImage || "";
      const status = statusInput.value;
      const tag = tagInput.value;
      const page = pageInput.value;

      if (!name || !price || !stock || !image) {
        showToast("‚ö† ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á");
        return;
      }

      const products = getProducts();
      const newData = { name, price, stock, image, status, tag, page};

      if (editIndex !== null) {
        products[editIndex] = newData;
        showToast("‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      } else {
        products.push(newData);
        showToast("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      }

      saveProducts(products);
      renderProducts();
      clearForm();
    });

    // ===== ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ =====
    window.editProduct = function (i) {
      const p = getProducts()[i];
      nameInput.value = p.name;
      priceInput.value = p.price;
      stockInput.value = p.stock;
      statusInput.value = p.status;
      tagInput.value = p.tag;
      pageInput.value = p.page;
      uploadedImage = p.image;
      editIndex = i;
      formTitle.textContent = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤";
      saveBtn.textContent = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç";
    };

    // ===== ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ =====
    window.deleteProduct = function (i) {
      if (!confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ?")) return;
      const p = getProducts();
      p.splice(i, 1);
      saveProducts(p);
      renderProducts();
      showToast("üóëÔ∏è ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
    };

    // ===== ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏° =====
    function clearForm() {
      nameInput.value = "";
      priceInput.value = "";
      stockInput.value = "";
      imageInput.value = "";
      uploadedImage = "";
      statusInput.value = "‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤";
      tagInput.value = "";
      pageInput.value = "both";
      editIndex = null;
      formTitle.textContent = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà";
      saveBtn.textContent = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤";
    }
    resetBtn.addEventListener("click", clearForm);

    // ===== ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö =====
    const logoutBtn = document.getElementById("logout-btn");
    const popup = document.getElementById("logout-popup");
    document.getElementById("cancel-logout").addEventListener("click", () => popup.classList.add("hidden"));
    document.getElementById("confirm-logout").addEventListener("click", () => {
      localStorage.removeItem("isLoggedIn");
      localStorage.removeItem("role");
      window.location.href = "login.html";
    });
    logoutBtn.addEventListener("click", () => popup.classList.remove("hidden"));

    // ===== ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô =====
    renderProducts();
  </script>
</body>
</html>
