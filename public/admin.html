<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ | ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</title>
  <link rel="stylesheet" href="admin.css" />
</head>
<body>

  <!-- üîπ Navbar -->
  <nav class="admin-navbar">
    <h1>Admin</h1>
    <div class="admin-nav-links">
      <a href="admin.html" class="active">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</a>
      <a href="product.html">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
      <button id="admin-logout-btn" class="admin-logout-btn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
  </nav>

  <!-- üîπ ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ -->
  <main class="admin-content">
    <h2>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>

    <div class="admin-search-filter">
      <input id="admin-search" type="text" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ / ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà" />
      <div class="admin-filter-group">
        <button class="admin-filter-btn" data-status="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        <button class="admin-filter-btn" data-status="‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß</button>
        <button class="admin-filter-btn" data-status="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏û‡πá‡∏Ñ">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏û‡πá‡∏Ñ</button>
        <button class="admin-filter-btn" data-status="‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß">‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</button>
      </div>
    </div>

    <div id="admin-orders-container" class="admin-orders-container"></div>
  </main>

  <!-- üîπ Popup ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö -->
  <div id="admin-logout-popup" class="admin-popup hidden">
    <div class="admin-popup-content">
      <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</h3>
      <p>‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?</p>
      <div class="admin-popup-buttons">
        <button id="admin-confirm-logout" class="admin-btn red">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        <button id="admin-cancel-logout" class="admin-btn gray">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </div>
  </div>

<script>
let adminCurrentFilter = "all";

function loadAdminOrders() {
  const orders = JSON.parse(localStorage.getItem("allOrders")) || [];
  const container = document.getElementById("admin-orders-container");
  const searchTerm = document.getElementById("admin-search")?.value.trim().toLowerCase() || "";

  const filteredOrders = orders.filter(order => {
    const matchSearch =
      order.username.toLowerCase().includes(searchTerm) ||
      order.date.toLowerCase().includes(searchTerm);
    const matchStatus =
      adminCurrentFilter === "all" ? true : order.status === adminCurrentFilter;
    return matchSearch && matchStatus;
  });

  if (filteredOrders.length === 0) {
    container.innerHTML = `<p class='admin-empty'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>`;
    return;
  }

  const sorted = filteredOrders.sort((a, b) => new Date(b.date) - new Date(a.date));

  container.innerHTML = sorted.map(order => `
    <div class="admin-order-card">
      <div class="admin-order-info">
        <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</strong> ${order.username}</p>
        <p><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${order.address}</p>
        <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</strong> ${order.phone || "-"}</p>
        <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</strong> ${order.date}</p>
        <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong>
          <span class="admin-status ${
            order.status === "‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß" ? "green" :
            order.status === "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏û‡πá‡∏Ñ" ? "yellow" : "blue"
          }">${order.status}</span>
        </p>
      </div>

      <div class="admin-item-list">
        ${order.items.map(item => `
          <div class="admin-item-tag">
            ${item.name} <span>√ó${item.quantity}</span>
          </div>
        `).join("")}
      </div>

      <div class="admin-action-buttons">
        ${order.status === "‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß" ? `
          <button 
            onclick="updateAdminStatus('${order.username}','${order.date}','‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏û‡πá‡∏Ñ')" 
            class="admin-btn yellow">
            ‡πÅ‡∏û‡πá‡∏Ñ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
          </button>
        ` : ""}
        ${order.status !== "‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß" ? `
          <button 
            onclick="updateAdminStatus('${order.username}','${order.date}','‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß')" 
            class="admin-btn green">
            ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
          </button>
        ` : ""}
      </div>

      ${order.status === "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏û‡πá‡∏Ñ" ? `
        <div class="shipping-info-box">
          <h4>üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏õ‡∏∞‡∏´‡∏ô‡πâ‡∏≤</h4>
          <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${order.username}</p>
          <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå:</strong> ${order.phone || "‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏"}</p>
          <p><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${order.address}</p>
          <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</strong> ${order.date}</p>
          <button class="copy-btn" onclick="copyShippingInfo(this)">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
      ` : ""}
    </div>
  `).join("");
}

function updateAdminStatus(username, date, newStatus) {
  const orders = JSON.parse(localStorage.getItem("allOrders")) || [];
  const targetIndex = orders.findIndex(o => o.username === username && o.date === date);
  if (targetIndex !== -1) {
    orders[targetIndex].status = newStatus;
    localStorage.setItem("allOrders", JSON.stringify(orders));
    loadAdminOrders();
  }
}

document.querySelectorAll(".admin-filter-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    adminCurrentFilter = btn.dataset.status;
    document.querySelectorAll(".admin-filter-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    loadAdminOrders();
  });
});

document.getElementById("admin-search")?.addEventListener("input", loadAdminOrders);

const logoutBtn = document.getElementById("admin-logout-btn");
const popup = document.getElementById("admin-logout-popup");
document.getElementById("admin-cancel-logout").addEventListener("click", () => popup.classList.add("hidden"));
document.getElementById("admin-confirm-logout").addEventListener("click", () => {
  localStorage.removeItem("isLoggedIn");
  localStorage.removeItem("role");
  localStorage.removeItem("username");
  window.location.href = "login.html";
});
logoutBtn.addEventListener("click", () => popup.classList.remove("hidden"));

loadAdminOrders();

function copyShippingInfo(btn) {
  const box = btn.closest(".shipping-info-box");
  const text = box.innerText.replace("üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏õ‡∏∞‡∏´‡∏ô‡πâ‡∏≤", "").trim();
  navigator.clipboard.writeText(text)
    .then(() => alert("‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!"))
    .catch(() => alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ"));
}
</script>

</body>
</html>
