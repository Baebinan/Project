<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shawty Shop | ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
</head>

<body>
  <!-- üîπ Navbar -->
  <header class="navbar">
    <div class="navbar-top">
      <div class="logo">
        <img src="../assets/image/star icon.jpg" alt="logo">
        <h1>Shawty Shop</h1>
      </div>

      <div class="nav-icons">
        <a id="cart-btn" class="cart-icon" role="button" aria-label="cart">
          <i class="bi bi-cart3"></i>
          <span id="cart-count">0</span>
        </a>
        <a id="profile-link" class="profile-icon" role="button" aria-label="profile">
          <i class="bi bi-person-circle"></i>
        </a>
      </div>
    </div>

    <nav class="navbar-bottom">
      <a href="index.html" class="active">HOME</a>
      <a href="all.html">ALL</a>
    </nav>
  </header>

  <!-- üîπ Section: ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ -->
  <main class="container">
    <h1 class="section-title">üî• ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h1>
    <div id="product-grid" class="product-grid"></div>
  </main>

  <!-- üîπ Popup ‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô -->
  <div id="cart-popup" class="cart-popup hidden">
    <div class="cart-content">
      <button id="close-cart" class="close-btn" aria-label="close cart">&times;</button>
      <h2>‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>

      <div id="cart-items" class="cart-items">
        <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å render ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
      </div>

      <div class="cart-summary">
        <div class="line"></div>
        <div class="row">
          <span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
          <strong id="cart-total">‡∏ø0.00</strong>
        </div>
      </div>

      <div class="cart-buttons">
        <button id="checkout-btn" class="btn green">‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
        <button id="clear-cart" class="btn red">‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô</button>
      </div>
    </div>
  </div>

  <!-- üîπ Toast -->
  <div id="toast" class="toast"></div>

  <!-- ===========================
       Script: ‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô (‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î)
  ============================ -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const cartBtn = document.getElementById("cart-btn");
      const cartPopup = document.getElementById("cart-popup");
      const closeCart = document.getElementById("close-cart");

      if (!cartBtn || !cartPopup || !closeCart) return;

      cartBtn.addEventListener("click", () => {
        renderCart();  // ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß render ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
        cartPopup.classList.remove("hidden");
      });

      closeCart.addEventListener("click", () => cartPopup.classList.add("hidden"));

      cartPopup.addEventListener("click", (e) => {
        if (e.target.id === "cart-popup") cartPopup.classList.add("hidden");
      });
    });
  </script>

  <!-- ===========================
       Script: ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ + ‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô + ‡∏ï‡∏£‡∏ß‡∏à‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
  ============================ -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const productGrid = document.getElementById("product-grid");
      const products = JSON.parse(localStorage.getItem("products")) || [];
      const featured = products.filter(p => p.page === "index" || p.page === "both");

      if (featured.length === 0) {
        productGrid.innerHTML = `<p class="text-center text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</p>`;
        return;
      }

      // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
      productGrid.innerHTML = featured.map(p => `
        <div class="product-card">
          <img src="${p.image}" alt="${p.name}">
          <h2>${p.name}</h2>
          <p>‡∏ø${p.price}</p>
          <button class="add-to-cart" data-id="${p.id}">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô</button>
        </div>
      `).join("");

      // ---------- Utils ‡πÄ‡∏Å‡πá‡∏ö/‡∏≠‡πà‡∏≤‡∏ô‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô ----------
      const getCart = () => JSON.parse(localStorage.getItem("cart")) || [];
      const setCart = (cart) => localStorage.setItem("cart", JSON.stringify(cart));

      function updateCartCount() {
        const total = getCart().reduce((sum, it) => sum + it.qty, 0);
        document.getElementById("cart-count").textContent = total;
      }

      function showToast(msg) {
        const toast = document.getElementById("toast");
        toast.textContent = msg;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 1800);
      }

      // ---------- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ----------
      function addItem(productId) {
        const user = JSON.parse(localStorage.getItem("user"));

        // ‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
        if (!user) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô");
          window.location.href = "login.html";
          return;
        }
        // ‚ùå ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°
        if (user.role === "admin" || user.username === "admin") {
          alert("‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô‡πÑ‡∏î‡πâ");
          return;
        }

        const product = products.find(p => String(p.id) === String(productId));
        if (!product) return;

        const cart = getCart();
        const found = cart.find(it => String(it.id) === String(product.id));
        if (found) {
          found.qty += 1;
        } else {
          cart.push({ id: product.id, name: product.name, price: Number(product.price), image: product.image, qty: 1 });
        }
        setCart(cart);
        updateCartCount();
        showToast("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß!");
      }

      // ---------- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô / ‡∏•‡∏ö ----------
      function changeQty(id, delta) {
        const cart = getCart();
        const item = cart.find(it => String(it.id) === String(id));
        if (!item) return;
        item.qty += delta;
        if (item.qty <= 0) {
          const idx = cart.findIndex(it => String(it.id) === String(id));
          cart.splice(idx, 1);
        }
        setCart(cart);
        renderCart();
        updateCartCount();
      }

      function removeItem(id) {
        const cart = getCart().filter(it => String(it.id) !== String(id));
        setCart(cart);
        renderCart();
        updateCartCount();
      }

      // ---------- Render ‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô ----------
      function renderCart() {
        const cartEl = document.getElementById("cart-items");
        const totalEl = document.getElementById("cart-total");
        const cart = getCart();

        if (!cartEl || !totalEl) return;

        if (cart.length === 0) {
          cartEl.innerHTML = `<p class="text-center text-gray-500">‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</p>`;
          totalEl.textContent = "‡∏ø0.00";
          return;
        }

        cartEl.innerHTML = cart.map(it => `
          <div class="cart-row" data-id="${it.id}">
            <div class="left">
              <img class="thumb" src="${it.image}" alt="${it.name}" />
              <div class="meta">
                <p class="name">${it.name}</p>
                <p class="price">‡∏ø${Number(it.price).toFixed(2)}</p>
              </div>
            </div>
            <div class="right">
              <button class="qty-btn dec" aria-label="decrease">‚àí</button>
              <span class="qty">${it.qty}</span>
              <button class="qty-btn inc" aria-label="increase">+</button>
              <button class="remove" aria-label="remove"><i class="bi bi-trash3"></i></button>
            </div>
          </div>
        `).join("");

        const total = cart.reduce((sum, it) => sum + Number(it.price) * it.qty, 0);
        totalEl.textContent = `‡∏ø${total.toFixed(2)}`;
      }

      // ---------- ‡∏ú‡∏π‡∏Å event ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô ----------
      document.querySelectorAll(".add-to-cart").forEach(btn => {
        btn.addEventListener("click", e => addItem(e.currentTarget.dataset.id));
      });

      // ---------- Event delegation ‡πÉ‡∏ô popup ‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô ----------
      document.getElementById("cart-items").addEventListener("click", (e) => {
        const row = e.target.closest(".cart-row");
        if (!row) return;
        const id = row.dataset.id;

        if (e.target.classList.contains("inc")) changeQty(id, +1);
        if (e.target.classList.contains("dec")) changeQty(id, -1);
        if (e.target.classList.contains("remove") || e.target.closest(".remove")) removeItem(id);
      });

      // ---------- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô ----------
      document.getElementById("clear-cart").addEventListener("click", () => {
        localStorage.removeItem("cart");
        renderCart();
        updateCartCount();
      });

      // ---------- ‡∏õ‡∏∏‡πà‡∏°‡∏ã‡∏∑‡πâ‡∏≠ ‚Üí ‡πÑ‡∏õ checkout.html (‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô) ----------
      document.getElementById("checkout-btn").addEventListener("click", () => {
        const user = JSON.parse(localStorage.getItem("user"));
        if (!user) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠");
          window.location.href = "login.html";
          return;
        }
        const cart = getCart();
        if (cart.length === 0) {
          alert("‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤");
          return;
        }
        // ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ checkout
        localStorage.setItem("checkoutItems", JSON.stringify(cart));
        window.location.href = "checkout.html";
      });

      // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      updateCartCount();
      window.renderCart = renderCart; // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠ debug
    });
  </script>

  <!-- ===========================
       Script: ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå ‚Üí ‡πÅ‡∏¢‡∏Å admin / user / ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
  ============================ -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const profileLink = document.getElementById("profile-link");
      if (!profileLink) return;

      profileLink.addEventListener("click", () => {
        const user = JSON.parse(localStorage.getItem("user"));

        if (!user) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô");
          window.location.href = "login.html";
          return;
        }

        if (user.role === "admin" || user.username === "admin") {
          window.location.href = "admin.html";
        } else {
          window.location.href = "profile.html";
        }
      });
    });
  </script>
</body>
</html>
